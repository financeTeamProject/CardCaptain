<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="search">
	<select id="searchKeyword" parameterType="hashmap" resultType="hashmap">
		SELECT C.CARD_NO,C.CARD_NAME,C.CARD_TYPE,B.BENEFIT_TOP,B.BENEFIT_TYPE_NO,C.CARD_IMG_URL,C.CARD_SUMMARY
		FROM CARDS C INNER JOIN CARDTYPES T 
							 ON C.CARD_NO = T.CARD_NO
					 INNER JOIN CARDBENEFITS B
							 ON T.CARD_NO = B.CARD_NO
		WHERE B.DETAIL_INFO LIKE '%'|| #{option} || '%'
		ORDER BY C.CARD_NO
	</select>
	
	<select id="cardNoDistinct" parameterType="hashmap" resultType="hashmap">
		SELECT DISTINCT(C.CARD_NO), C.CARD_IMG_URL, C.CARD_NAME
		FROM CARDS C INNER JOIN CARDTYPES T 
							 ON C.CARD_NO = T.CARD_NO
					 INNER JOIN CARDBENEFITS B
							 ON T.CARD_NO = B.CARD_NO
		WHERE B.DETAIL_INFO LIKE '%'|| #{option} || '%'
		ORDER BY C.CARD_NO
	</select>
	
	<select id="paging" parameterType="hashmap" resultType="hashmap">
		SELECT A.CARD_NO,A.CARD_NAME,A.CARD_TYPE,A.BENEFIT_TOP,A.BENEFIT_TYPE_NO,A.CARD_IMG_URL,A.CARD_SUMMARY 
		FROM (SELECT C.CARD_NO,C.CARD_NAME,C.CARD_TYPE,B.BENEFIT_TOP,B.BENEFIT_TYPE_NO,C.CARD_IMG_URL,C.CARD_SUMMARY, ROW_NUMBER() OVER(ORDER BY C.CARD_NO) AS RNUM
				FROM CARDS C INNER JOIN CARDTYPES T 
									 ON C.CARD_NO = T.CARD_NO
							 INNER JOIN CARDBENEFITS B
									 ON T.CARD_NO = B.CARD_NO
				WHERE B.DETAIL_INFO LIKE '%'|| #{option} || '%'
				ORDER BY C.CARD_NO) A
	</select>
	
	<select id="pagingDistinct" parameterType="hashmap" resultType="hashmap">
		SELECT B.CARD_NO, B.CARD_NAME, B.CARD_IMG_URL,B.RNUM
		FROM (SELECT A.CARD_NO, A.CARD_NAME, A.CARD_IMG_URL, ROW_NUMBER() OVER(ORDER BY A.CARD_NO) AS RNUM 
				FROM (SELECT DISTINCT C.CARD_NO, C.CARD_NAME, C.CARD_IMG_URL
						FROM CARDS C INNER JOIN CARDTYPES T 
											 ON C.CARD_NO = T.CARD_NO
									 INNER JOIN CARDBENEFITS B
											 ON T.CARD_NO = B.CARD_NO
						WHERE B.DETAIL_INFO LIKE '%'|| #{option} || '%'
        		ORDER BY C.CARD_NO) A
		) B
		WHERE B.RNUM BETWEEN #{startCnt} AND #{endCnt}
	</select>
	
	<select id="checkKeyword" parameterType="String" resultType="hashmap">
		SELECT C.CARD_NO,C.CARD_NAME,C.CARD_TYPE,B.BENEFIT_TOP,B.BENEFIT_TYPE_NO,C.CARD_IMG_URL,C.CARD_SUMMARY
		FROM CARDS C INNER JOIN CARDTYPES T 
							 ON C.CARD_NO = T.CARD_NO
					 INNER JOIN CARDBENEFITS B
							 ON T.CARD_NO = B.CARD_NO
		WHERE B.BENEFIT_TOP IN (${value})
		ORDER BY C.CARD_NO
	</select>
	
	<select id="checkcardNoDistinct" parameterType="String" resultType="hashmap">
		SELECT DISTINCT(C.CARD_NO), C.CARD_IMG_URL, C.CARD_NAME
		FROM CARDS C INNER JOIN CARDTYPES T 
							 ON C.CARD_NO = T.CARD_NO
					 INNER JOIN CARDBENEFITS B
							 ON T.CARD_NO = B.CARD_NO
		WHERE B.BENEFIT_TOP IN (${value})
		ORDER BY C.CARD_NO
	</select>
	<!-- params.put으로 넣어도 안에 값이 String이면 '$'를 써야 함 -->
	<select id="checkpagingDistinct" parameterType="hashmap" resultType="hashmap">
		SELECT B.CARD_NO, B.CARD_NAME, B.CARD_IMG_URL,B.RNUM
		FROM (SELECT A.CARD_NO, A.CARD_NAME, A.CARD_IMG_URL, ROW_NUMBER() OVER(ORDER BY A.CARD_NO) AS RNUM 
				FROM (SELECT DISTINCT C.CARD_NO, C.CARD_NAME, C.CARD_IMG_URL
						FROM CARDS C INNER JOIN CARDTYPES T 
											 ON C.CARD_NO = T.CARD_NO
									 INNER JOIN CARDBENEFITS B
											 ON T.CARD_NO = B.CARD_NO
						WHERE B.BENEFIT_TOP IN (${data})
        		ORDER BY C.CARD_NO) A
		) B
		WHERE B.RNUM BETWEEN #{startCnt} AND #{endCnt}
	</select>
	
	<select id="randomCard" parameterType="hashmap" resultType="hashmap">
		SELECT A.CARD_NO, A.CARD_SUMMARY, A.CARD_NAME, A.SHOP_INFO
		FROM(SELECT DISTINCT B.CARD_NO, C.CARD_SUMMARY, C.CARD_NAME, B.SHOP_INFO
					FROM CARDS C INNER JOIN CARDBENEFITS B
                                 ON C.CARD_NO = B.CARD_NO AND B.SHOP_INFO IS NOT NULL AND C.CARD_SUMMARY IS NOT NULL
			 ORDER BY DBMS_RANDOM.VALUE) A
		WHERE ROWNUM = 1
	</select>
</mapper>