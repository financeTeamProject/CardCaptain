<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="R">
	<!-- 신용카드 TOP 10 -->
	<select id="getRCredit" parameterType="hashmap" resultType="hashmap">
		SELECT C.CARD_NO, C.CARD_CMP_NO, C.CARD_CMP_NAME, C.CARD_NAME, C.CARD_SUMMARY, 
            C.CARD_IMG_URL, C.CLICK_CNT, C.RNK
		FROM(SELECT C.*, CMP.CARD_CMP_NAME,
		           ROW_NUMBER() OVER(ORDER BY CLICK_CNT DESC) AS RNK 
		     FROM CARDS C INNER JOIN CARDCOMPANYS CMP
		                          ON  C.CARD_CMP_NO = CMP.CARD_CMP_NO
		                          AND CARD_TYPE = 0) C 
		WHERE C.RNK BETWEEN 1 AND 10
	</select>

	<!-- 신용카드 TOP 10 -->
	<select id="getRCheck" parameterType="hashmap" resultType="hashmap">
		SELECT C.CARD_NO, C.CARD_CMP_NO, C.CARD_CMP_NAME, C.CARD_NAME, C.CARD_SUMMARY, 
            C.CARD_IMG_URL, C.CLICK_CNT, C.RNK
		FROM(SELECT C.*, CMP.CARD_CMP_NAME,
		           ROW_NUMBER() OVER(ORDER BY CLICK_CNT DESC) AS RNK 
		     FROM CARDS C INNER JOIN CARDCOMPANYS CMP
		                          ON  C.CARD_CMP_NO = CMP.CARD_CMP_NO
		                          AND CARD_TYPE = 1) C 
		WHERE C.RNK BETWEEN 1 AND 10
	</select>
	
	<!-- 카드상세보기  -->
	<select id="getCView" parameterType="hashmap" resultType="hashmap">
		SELECT C.CARD_NO, C.CARD_NAME, C.CARD_IMG_URL, C.CLICK_CNT, CBF.BENEFIT_TOP, CBF.BENEFIT_MID, CBF.DETAIL_INFO,
            CMP.CARD_CMP_NAME, C.CARD_APPLY_URL, CBF.BENEFIT_IMG_URL
		FROM CARDS C INNER JOIN CARDBENEFITS CBF
		                    ON  C.CARD_NO = CBF.CARD_NO
		             INNER JOIN CARDCOMPANYS CMP
		                    ON  C.CARD_CMP_NO = CMP.CARD_CMP_NO
		WHERE C.CARD_NO = #{cardNo}
	</select>
	
	<!-- 카드사별 Top 1  -->
	<select id="cmpTop1" parameterType="hashmap" resultType="hashmap">
		SELECT CC.CARD_CMP_NO, CC.CARD_CMP_NAME, CC.CARD_NO, CC.CARD_NAME, CC.CARD_SUMMARY, CBF.BENEFIT_TOP, CC.CARD_IMG_URL,
            CC.CLICK_CNT, CC.RNK
		FROM(SELECT CMP.CARD_CMP_NO, CMP.CARD_CMP_NAME, C.CARD_NO, C.CARD_NAME, C.CARD_SUMMARY, C.CARD_IMG_URL,
		            C.CLICK_CNT, ROW_NUMBER() OVER(ORDER BY C.CLICK_CNT DESC) AS RNK
		     FROM CARDS C INNER JOIN CARDCOMPANYS CMP
		                     ON C.CARD_CMP_NO = CMP.CARD_CMP_NO
		     WHERE C.CARD_CMP_NO = #{cmpNo}) CC INNER JOIN CARDBENEFITS CBF
                                           ON CC.CARD_NO = CBF.CARD_NO
                                           AND RNK = 1
	</select>
	<!-- 카드사별 Top 2  -->
	<select id="cmpTop2" parameterType="hashmap" resultType="hashmap">
		SELECT CC.CARD_CMP_NO, CC.CARD_CMP_NAME, CC.CARD_NO, CC.CARD_NAME, CC.CARD_SUMMARY, CBF.BENEFIT_TOP, CC.CARD_IMG_URL,
            CC.CLICK_CNT, CC.RNK
		FROM(SELECT CMP.CARD_CMP_NO, CMP.CARD_CMP_NAME, C.CARD_NO, C.CARD_NAME, C.CARD_SUMMARY, C.CARD_IMG_URL,
		            C.CLICK_CNT, ROW_NUMBER() OVER(ORDER BY C.CLICK_CNT DESC) AS RNK
		     FROM CARDS C INNER JOIN CARDCOMPANYS CMP
		                     ON C.CARD_CMP_NO = CMP.CARD_CMP_NO
		     WHERE C.CARD_CMP_NO = #{cmpNo}) CC INNER JOIN CARDBENEFITS CBF
                                           ON CC.CARD_NO = CBF.CARD_NO
                                           AND RNK = 2
	</select>
	<!-- 카드사별 Top 3  -->
	<select id="cmpTop3" parameterType="hashmap" resultType="hashmap">
		SELECT CC.CARD_CMP_NO, CC.CARD_CMP_NAME, CC.CARD_NO, CC.CARD_NAME, CC.CARD_SUMMARY, CBF.BENEFIT_TOP, CC.CARD_IMG_URL,
            CC.CLICK_CNT, CC.RNK
		FROM(SELECT CMP.CARD_CMP_NO, CMP.CARD_CMP_NAME, C.CARD_NO, C.CARD_NAME, C.CARD_SUMMARY, C.CARD_IMG_URL,
		            C.CLICK_CNT, ROW_NUMBER() OVER(ORDER BY C.CLICK_CNT DESC) AS RNK
		     FROM CARDS C INNER JOIN CARDCOMPANYS CMP
		                     ON C.CARD_CMP_NO = CMP.CARD_CMP_NO
		     WHERE C.CARD_CMP_NO = #{cmpNo}) CC INNER JOIN CARDBENEFITS CBF
                                           ON CC.CARD_NO = CBF.CARD_NO
                                           AND RNK = 3
	</select>
</mapper>